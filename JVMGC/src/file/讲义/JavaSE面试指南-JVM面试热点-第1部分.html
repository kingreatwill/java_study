<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>JavaSE面试指南-JVM面试热点-第1部分</title><link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:first-child { margin-top: -20px; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; }
button, input, select, textarea { color: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 2; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px !important; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 32px; padding-right: 32px; padding-bottom: 0px; break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  @page { margin: 20mm 0px; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="mermaid"] svg, [lang="flow"] svg { max-width: 100%; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root { --side-bar-bg-color: #fafafa; --control-text-color: #777; }
html { font-size: 16px; }
body { font-family: "Open Sans", "Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif; color: rgb(51, 51, 51); line-height: 1.6; }
#write { max-width: 860px; margin: 0px auto; padding: 30px 30px 100px; }
#write > ul:first-child, #write > ol:first-child { margin-top: 30px; }
a { color: rgb(65, 131, 196); }
h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; cursor: text; }
h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; }
h1 tt, h1 code { font-size: inherit; }
h2 tt, h2 code { font-size: inherit; }
h3 tt, h3 code { font-size: inherit; }
h4 tt, h4 code { font-size: inherit; }
h5 tt, h5 code { font-size: inherit; }
h6 tt, h6 code { font-size: inherit; }
h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid rgb(238, 238, 238); }
h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid rgb(238, 238, 238); }
h3 { font-size: 1.5em; line-height: 1.43; }
h4 { font-size: 1.25em; }
h5 { font-size: 1em; }
h6 { font-size: 1em; color: rgb(119, 119, 119); }
p, blockquote, ul, ol, dl, table { margin: 0.8em 0px; }
li > ol, li > ul { margin: 0px; }
hr { height: 2px; padding: 0px; margin: 16px 0px; background-color: rgb(231, 231, 231); border: 0px none; overflow: hidden; box-sizing: content-box; }
li p.first { display: inline-block; }
ul, ol { padding-left: 30px; }
ul:first-child, ol:first-child { margin-top: 0px; }
ul:last-child, ol:last-child { margin-bottom: 0px; }
blockquote { border-left: 4px solid rgb(223, 226, 229); padding: 0px 15px; color: rgb(119, 119, 119); }
blockquote blockquote { padding-right: 0px; }
table { padding: 0px; word-break: initial; }
table tr { border-top: 1px solid rgb(223, 226, 229); margin: 0px; padding: 0px; }
table tr:nth-child(2n), thead { background-color: rgb(248, 248, 248); }
table tr th { font-weight: bold; border-width: 1px 1px 0px; border-top-style: solid; border-right-style: solid; border-left-style: solid; border-top-color: rgb(223, 226, 229); border-right-color: rgb(223, 226, 229); border-left-color: rgb(223, 226, 229); border-image: initial; border-bottom-style: initial; border-bottom-color: initial; text-align: left; margin: 0px; padding: 6px 13px; }
table tr td { border: 1px solid rgb(223, 226, 229); text-align: left; margin: 0px; padding: 6px 13px; }
table tr th:first-child, table tr td:first-child { margin-top: 0px; }
table tr th:last-child, table tr td:last-child { margin-bottom: 0px; }
.CodeMirror-lines { padding-left: 4px; }
.code-tooltip { box-shadow: rgba(0, 28, 36, 0.3) 0px 1px 1px 0px; border-top: 1px solid rgb(238, 242, 242); }
.md-fences, code, tt { border: 1px solid rgb(231, 234, 237); background-color: rgb(248, 248, 248); border-radius: 3px; padding: 2px 4px 0px; font-size: 0.9em; }
code { background-color: rgb(243, 244, 244); padding: 0px 2px; }
.md-fences { margin-bottom: 15px; margin-top: 15px; padding-top: 8px; padding-bottom: 6px; }
.md-task-list-item > input { margin-left: -1.3em; }
@media print {
  html { font-size: 13px; }
  table, pre { break-inside: avoid; }
  pre { word-wrap: break-word; }
}
.md-fences { background-color: rgb(248, 248, 248); }
#write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; background-color: rgb(247, 247, 247); border: 0px; border-radius: 3px; color: rgb(119, 119, 119); margin-top: 0px !important; }
.mathjax-block > .code-tooltip { bottom: 0.375rem; }
.md-mathjax-midline { background: rgb(250, 250, 250); }
#write > h3.md-focus::before { left: -1.5625rem; top: 0.375rem; }
#write > h4.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h5.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h6.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
.md-image > .md-meta { border-radius: 3px; padding: 2px 0px 0px 4px; font-size: 0.9em; color: inherit; }
.md-tag { color: rgb(167, 167, 167); opacity: 1; }
.md-toc { margin-top: 20px; padding-bottom: 20px; }
.sidebar-tabs { border-bottom: none; }
#typora-quick-open { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); }
#typora-quick-open-item { background-color: rgb(250, 250, 250); border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238); border-style: solid; border-width: 1px; }
.on-focus-mode blockquote { border-left-color: rgba(85, 85, 85, 0.12); }
header, .context-menu, .megamenu-content, footer { font-family: "Segoe UI", Arial, sans-serif; }
.file-node-content:hover .file-node-icon, .file-node-content:hover .file-node-open-state { visibility: visible; }
.mac-seamless-mode #typora-sidebar { background-color: var(--side-bar-bg-color); }
.md-lang { color: rgb(180, 101, 77); }
.html-for-mac .context-menu { --item-hover-bg-color: #E6F0FE; }
#md-notification .btn { border: 0px; }
.dropdown-menu .divider { border-color: rgb(229, 229, 229); }





 .typora-export li, .typora-export p, .typora-export,  .footnote-line {white-space: normal;} 
</style>
</head>
<body class='typora-export os-windows' >
<div  id='write'  class = 'is-node'><p>&nbsp;</p><h2><a name='header-n2' class='md-header-anchor '></a>今日内容</h2><ul><li><p>认识类加载过程</p></li><li><h6><a name='header-n7' class='md-header-anchor '></a>认识JVM内存模型</h6></li></ul><h2><a name='header-n8' class='md-header-anchor '></a>1. 类加载</h2><h3><a name='header-n9' class='md-header-anchor '></a>1.1 Java类编译、运行机制</h3><ul><li><p>回顾原始命令</p><p><strong>案例1-1</strong>：使用java命令来运行HelloWorld类</p><blockquote><p><strong>步骤一</strong>：书写HelloWorld类</p></blockquote><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8.16406px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">package</span> <span class="cm-def">com</span>.<span class="cm-variable">itheima</span>.<span class="cm-variable">demo1_1</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-comment">* 1.使用java命令来执行一个HelloWorld类</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-comment">*/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">HelloWorld</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-string">"hello world!"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 203px;"></div><div class="CodeMirror-gutters" style="display: none; height: 203px;"></div></div></div></pre><blockquote><p><strong>步骤二</strong>：使用javac和java 命令分别编译和执行</p></blockquote><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 7.99478px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-comment">//编译成class文件 -d 代表</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">javac</span> <span class="cm-operator">-</span><span class="cm-variable">d</span> . <span class="cm-variable">HelloWorld</span>.<span class="cm-variable">java</span> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-comment">//运行class文件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">java</span> &nbsp;<span class="cm-variable">com</span>.<span class="cm-variable">itheima</span>.<span class="cm-variable">HelloWorld</span> &nbsp; &nbsp; </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><blockquote><p><strong>总结</strong>：</p></blockquote><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8.16406px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">1.</span><span class="cm-variable">由于HelloWorld</span>.<span class="cm-variable">java文件中声明了包，所以在运行的时候一定要带全限定包名。如果不带会出现如下异常：</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-string">"错误: 找不到或无法加载主类 HelloWorld"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">2.</span><span class="cm-variable">加上全限定名称，才是一个class文件真正的完整的名称。后面要讲解的ClassLoader会按照真正完整的名称去</span> &nbsp; <span class="cm-variable">找。</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre></li><li><p>全局过程</p><p><img src='../画图/typora-images/1557475297814.png' alt='1557475297814' referrerPolicy='no-referrer' /></p><ul><li><p><strong>编译过程</strong> ： 当执行“javac HelloWorld.java”命令的时候，会.java源文件编译成.class二进制字节码文件。</p></li><li><p><strong>运行过程</strong></p><p>1.类加载</p></li></ul><p>                编译好的字节码文件首先经过字节码校验器对文件进行校验,最终要通加载器加载   </p><p>         到JVM虚拟机中。这里需要说明一下，程序第1次主动使用类的时候，才会去加载该<span>	</span></p><p>         类。也就是说不是一开始就把所有的类都加载到内存中，用的的时候才会加
​         载，并且只加载一次。</p><p>       2.类的执行</p><p>                当执行“java com.itheima.HelloWorld” 命令的时候，系统就会启动一个JVM进</p><p>        程，JVM进程从classpath路径中找到一个HelloWorld.class二进制文件，首先将   </p><p>        HelloWorld类信息加载到方法区内，这个过程叫做类加载过程。JVM完成堆栈内存存储</p><p>        数据之后，JVM解释完之后，会将该文件发送给JIT编译器(将class文件编译成机器代s</p><p>        码)。</p></li><li><p><strong>问题回答:</strong>  3个关键词</p><ul><li><p><strong>编译</strong>：Java编译器会对源文件进行编译成class字节码文件，这一过程就叫做“编译过程”。</p></li><li><p><strong>加载</strong>：类加载器会将class字节码文件加载到JVM完成解释</p></li><li><p><strong>运行</strong>：JVM将class字节码文件解释完之后会发给JIT编译器，以翻译成机器代码，进行运  </p><p>           行。</p></li></ul></li></ul><h3><a name='header-n51' class='md-header-anchor '></a>1.2 类加载生命周期</h3><ul><li><p>类加载生命周期</p><p><img src='../画图/typora-images/1557885260179.png' alt='1557885260179' referrerPolicy='no-referrer' /></p><blockquote><p>       通过上图可以看到，Class类加载的整个生命周期中，包括5个阶段，但是其中三个阶段是主要的，分别如下：</p></blockquote><ul><li><p><u><strong>加载</strong></u>：通过类的全限定名来获取定义此类的二进制字节流，将内部静态结构转为方法区的运行是数据结构，并在堆中生成一个java.lang.Class对象。Java虚拟机不会无条件装载Class类型，必须要求类或者接口必须是<mark>主动引用</mark>，才能被装载。</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8.16406px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">1.</span><span class="cm-variable">当创建一个类的实例时，比如使用new关键字，或者通过反射、克隆、反序列化。</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">2.</span><span class="cm-variable">当调用类的静态方法时，即当使用了字节码invokestatic指令。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">3.</span><span class="cm-variable">当使用类或者接口的静态字段时（final常量除外），比如，使用getstatic指令。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">4.</span><span class="cm-variable">当使用java</span>.<span class="cm-variable">lang</span>.<span class="cm-variable">reflect包中的方法反射类的方法时。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">5.</span><span class="cm-variable">当初始化子类时，要求先初始化父类。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">6.</span><span class="cm-variable">作为启动虚拟机，含有main</span>()<span class="cm-variable">方法的那个类。</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">除了以上的情况属于主动使用，其他的情况均属于被动使用。被动使用不会引起类的初始化。</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 158px;"></div><div class="CodeMirror-gutters" style="display: none; height: 158px;"></div></div></div></pre></li><li><p><u><strong>连接</strong></u>：将已读入内存的二进制数据合并到JVM运行时环境中</p></li><li><p><u><strong>初始化</strong></u>：JVM会按照初始化语句在类文件中的先后顺序执行</p></li></ul></li><li><p><strong>案例1-2-1</strong>：主动引用</p><blockquote><p><strong>步骤一</strong>：创建Father类和Son类</p></blockquote><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8.16406px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">/**</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> * 父类</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> */</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">public class Father {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  static {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  System.out.println("完成父类静态代码块初始化");</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  public static String myname="itheima";</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">/**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> * 创建子类继承父类</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> */</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">public class Son extends  Father{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  static {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  System.out.println("完成子类静态代码块初始化");</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 383px;"></div><div class="CodeMirror-gutters" style="display: none; height: 383px;"></div></div></div></pre><blockquote><p><strong>步骤二</strong>：创建测试类，测试调用父类静态变量</p></blockquote><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 7.99478px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-comment">* 测试：子类调用父类静态成员，是否对子类进行加载和初始化？</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-comment">*/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">LoaderFatherTest</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">public</span> <span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-variable">main</span>(<span class="cm-variable-3">String</span>[] <span class="cm-variable">args</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">Son</span> <span class="cm-variable">son</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Son</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 203px;"></div><div class="CodeMirror-gutters" style="display: none; height: 203px;"></div></div></div></pre><blockquote><p><strong>步骤三</strong>：在VM option中添加java命令执行可以实现追踪类加载过程信息的参数</p></blockquote><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 7.99478px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-operator">-</span><span class="cm-variable">XX</span>:<span class="cm-operator">+</span><span class="cm-variable">TraceClassLoading</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>  控制台打印：</p><p><img src='../画图/typora-images/1559457796292.png' alt='1559457796292' referrerPolicy='no-referrer' /></p><blockquote><p><strong>总结</strong>：</p></blockquote><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="java"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8.16406px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">1.</span><span class="cm-variable">通过new关键词创建类的实例会加载相关类，首先加载Father类，再加载Son类</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">2.</span><span class="cm-variable">在初始化子类的时候，首先先初始化父类。</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p></li><li><p><strong>案例1-2-2</strong>：被动引用不会导致类的装载案例</p><blockquote><p><strong>步骤一</strong>：创建测试类，测试调用父类静态变量</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n87" mdtype="fences">在案例1-2-1基础上修改测试类
/**
 * 测试：子类调用父类静态成员，是否对子类进行加载和初始化？
 */
public class LoaderFatherTest {
    public static void main(String[] args) {
        System.out.println(Son.myname);
    }
}
</pre><p>控制台打印：</p><p><img src='../画图/typora-images/1559456749252.png' alt='1559456749252' referrerPolicy='no-referrer' /></p><blockquote><p><strong>总结</strong>：</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n92" mdtype="fences">1.Father类和Son类都有被类加载器加载JVM中了。
2.打印出了“完成父类静态代码块初始化”语句说明父类Father类进行初始化。但是
    子类Son虽然被加载了但是没有被初始化。
3.打印出了“itheima”数值，则说明了只有直接定义该字段的类才会被初始化。  
</pre></li></ul><h3><a name='header-n93' class='md-header-anchor '></a>1.3 双亲委派机制</h3><ul><li><p><strong>类加载器介绍</strong></p><ul><li><p>类加载器作用</p><p>      类加载器可以将classpath目录下.class文件,加载到内存中来进行一些处理,处理完的结果就是一些字节码。</p></li><li><p>类加载器本质</p></li></ul><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n103" mdtype="fences">  Java虚拟机中可以安装多个类加载器，系统默认的3个加载器，每个类加载器负责加载不同位置的 类:BootStrap,ExtClassLoader,AppClassLoader。类加载器也是java类，但是这里说一下BootStrap不是
一个java类，不需要类加载器加载，它是嵌套在JVM中内核里面的。它可以加载ExtClassLoader和 
AppClassLoader加载器。
</pre><p>&nbsp;</p></li><li><p><strong>双亲委派机制介绍</strong></p><p>        从JDK1.2开始类加载采用父亲委托机制。如果一个类加载器收到了类加载器的请求.它首先不会自己去尝试加载这个类.而是把这个请求委派给父加载器去完成.每个层次的类加载器都是如此.因此所有的加载请求最终都会传送到Bootstrap类加载器(启动类加载器)中.只有父类加载反馈自己无法加载这个请求(它的搜索范围中没有找到所需的类)时.子加载器才会尝试自己去加载。</p><p><img src='../画图/typora-images/1557888140768.png' alt='1557888140768' referrerPolicy='no-referrer' /></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n109" mdtype="fences">1.启动类加载器
   Bootstrap ClassLoader，负责加载存放在JDKjrelib(JDK代表JDK的安装目录，下同)下，或被-Xbootclasspath参数指定的路径中的，并且能被虚拟机识别的类库（如rt.jar，所有的java.*开头的类均被Bootstrap ClassLoader加载）。启动类加载器是无法被Java程序直接引用的。
2.扩展类加载器
   Extension ClassLoader，该加载器由sun.misc.Launcher$ExtClassLoader实现，它负责加载DKjrelibext目录中，或者由java.ext.dirs系统变量指定的路径中的所有类库（如javax.*开头的类），开发者可以直接使用扩展类加载器。
3.应用程序类加载器
   Application ClassLoader，该类加载器由sun.misc.Launcher$AppClassLoader来实现，它负责加载用户类路径（ClassPath）所指定的类，开发者可以直接使用该类加载器，如果应用程序中没有自定义过自己的类加载器，一般情况下这个就是程序中默认的类加载器。
</pre><p>&nbsp;</p></li><li><p>类加载器委派过程</p><p><strong>案例1-3</strong>:   打印所当前类的所有上层的加载器的名称</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n114" mdtype="fences" style="break-inside: unset;">/**
 * 打印出测试类所有加载器
 */
public class ClassLoaderTest {
    public static void main(String[] args) {
        ClassLoader classLoader = ClassLoaderTest.class.getClassLoader();
        while(classLoader!=null){
            String name = classLoader.getClass().getName();
            System.out.print("----&gt; " + name);
            classLoader = classLoader.getParent();
        }
        System.out.println("----&gt;"classLoader);
    }
}
</pre><p>控制台打印：<span>	</span></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n116" mdtype="fences">sun.misc.Launcher$AppClassLoader----&gt;sun.misc.Launcher$ExtClassLoader----&gt;null
</pre><blockquote><p><strong>总结</strong></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n119" mdtype="fences">  从上面的结果可以看出，并没有获取到ExtClassLoader的父Loader，原因是Bootstrap Loader（引导类加载器）是用C语言实现的，找不到一个确定的返回父Loader的方式，于是就返回null。
</pre><p>&nbsp;</p><blockquote><p><mark>面试热频问题1</mark>：java类从编译到运行完整过程是怎样的？  编译+加载+运行
<mark>面试热频问题2</mark>：什么是类加载器？ 类加载器是什么+三种类型的加载器
<mark>面试热频问题3</mark>：类装载流程是怎样的？ 加载+连接+初始化（加载进去之后，要满足主动引用条件）
<mark>面试热频问题4</mark>：请你说一下类加载中双亲委派机制是什么？下层到上层委派，上层到下层 2个过程</p></blockquote></li></ul><hr /><h2><a name='header-n124' class='md-header-anchor '></a>2. JVM的内存模型</h2><h3><a name='header-n125' class='md-header-anchor '></a>2.1 JVM三种类型参数</h3><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n126" mdtype="fences" style="break-inside: unset;">jvm的参数类型分为三类，分别是：
(1)标准参数
    -help     查看帮助文档
    -version  查看版本
    -classpath 指定class路径
    -server： 服务端模式
	-client： 客户端模式
	-showversion  输出产品版本并继续
(2)-X参数 （非标准参数）
    -Xint ：设置为解释模式执行
    -Xcomp：设置为编译模式执行，编译模式下，第1次执行会比解释模型要慢一些
    -Xmixed：默认为混合模式
(3)-XX参数（相对不稳定，用户可以自己设置，jvm调优和debug都是用这类参数，使用率较高）
   1.-XX:[+-]&lt;NAME&gt;表示启用或者禁用name属性  
       例如：-XX:+UseG1GC ，表示启动UseG1进行垃圾回收
   2.-XX:&lt;NAME&gt;=&lt;VALUE&gt;表示name属性的值是value  
       例如：-XX:MaxGCPauseMillis=500
       例如：-XX:NewRatio=1 ，表示新生代和老年代的比值
   3.特例
       例如：-Xms等价于-XX:InitialHeapSize -Xms512m  设置JVM初始堆内存为512M
       例如：-Xmx等价于-XX:MaxHeapSize  -Xmx2048m 设置JVM最大堆内存为2048M
</pre><p><strong>案例2-1-1</strong>：标准参数-D设置系统属性</p><blockquote><p><strong>步骤一</strong>：创建JVMOptionsTest类</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n130" mdtype="fences">public class JVMOptionsTest {
    public static void main(String[] args) {
        String myname = System.getProperty("myname");
        System.out.println("从jvm系统中获取的myname变量值为 = " + myname);
    }
}   
</pre><blockquote><p><strong>步骤二</strong>：添加标准化参数 -Dmyname=itheima</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n133" mdtype="fences">方法一：使用命令运行
  java  -Dmyname=itheima com.itheima.demo2_1.JVMOptionsTest
方法二：在开发工具中的JVM options中设置
  -Dmyname=itheima    
注意：这里的-D后面参数名称有大小写区分。
</pre><p><strong>案例2-1-2</strong>：非标准参数-X设置不同模式执行</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n135" mdtype="fences">java  -showversion -Xint  com.itheima.demo2_1.JVMOptionsTest     //设置解释模式
java  -showversion -Xcomp com.itheima.demo2_1.JVMOptionsTest    //设置编译模式
java  -showversion com.itheima.demo2_1.JVMOptionsTest   //默认的混合模式
</pre><p><strong>案例2-1-3</strong>：非标准参数-XX参数</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n137" mdtype="fences">1.-XX:+DisableExplicitGC 表示禁用手动调用gc操作，也就是说调用System.gc()无效
   java -showversion -XX:+DisableExplicitGC com.itheima.demo2_1.JVMOptionsTest 
   
2.-Xms512m -Xmx2048m 分别设置初始化堆内存大小、最大堆内存大小
   java -Xms512m -Xmx2048m com.itheima.demo2_1.JVMOptionsTest
</pre><h3><a name='header-n138' class='md-header-anchor '></a>2.2 JVM内存逻辑模型</h3><ul><li><p>JVM运行内存逻辑模型</p><p><img src='..\画图\typora-images\jvm内存.jpg' alt='吧' referrerPolicy='no-referrer' /></p><ul><li><p>虚拟机栈：</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n146" mdtype="fences">  Java虚拟机栈也是线程私有的内存空间，它和Java线程在同一个时间创建，它保存方法局部变量、部分结果，并参与方法的调用和返回。
</pre></li><li><p>堆：</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n149" mdtype="fences">   Java堆可以说是Java运行时内存中最为重要的部分，几乎所有的对象和数组都是堆中分配空间的。Java堆分为新生代和老年代两个部分，新生代用于存放刚刚产生的对象和年轻的对象，如果对象一直没有被回收，生存得足够长，老年对象就会被移入老年代。
</pre></li><li><p>方法区：</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n152" mdtype="fences">   方法区也叫永久区，它是JVM内存区中非常重要的一块内存区域，与堆空间类似，它也是被JVM中所有线程共享的。方法区主要保存的信息是类的元数据。这些元数据包括：类的类型信息(类名、父类名、修饰符等)、常量池、域信息、方法信息(方法名、返回类型、方法参数、修改符等)。总之，方法区中保存的信息，大部分来自于class文件，也是Java应用程序运行必不可少的重要数据。   
</pre></li><li><p>程序计数器： </p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n155" mdtype="fences"> 程序计数器是一块很小内存空间。由于Java是支持线程的语言，当线程数量超过CPU数量时，线程之间根据时间片轮训抢夺CPU资源。对于单核CPU而言，每一个时刻，只能有一个线程在运行，而其他线程必须被切换出去。为此，每一个线程都必须用一个独立的程序计数器，用于记录下一条要运行的指令。各个线程之间的计数器互不影响，独立工作；是一块线程私有内存空间。如果当前线程正在执行一个Java方法，则程序计数器记录正在执行的Java字节码地址，如果当前线程正在执行一个Native方法，则程序计数器为空。
</pre></li><li><p>本地方法栈:</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n158" mdtype="fences">   本地方法栈和Java虚拟机栈的功能很相似，Java虚拟机栈用于管理Java函数调用，而本地方法栈用于管理本地方法的调用。本地方法并不是用Java实现的，而是使用C实现的。在SUN 的HotSpot虚拟机中，不区分本地方法栈和虚拟机栈。因为，和虚拟机栈一样，它也会抛出StackOverflowError和OutOfMemoryError。
</pre><p><strong>总结：</strong>    </p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n160" mdtype="fences">  JVM运行内存逻辑模型包括堆、虚拟机栈、方法区、程序计算器、本地方法栈。其中堆、虚拟机栈、方法区是我们要重点理解的，学习JVM是帮助我们做JVM调优，而堆、栈、方法区是最常见的优化关注3块。
</pre></li></ul></li></ul><h3><a name='header-n161' class='md-header-anchor '></a>2.3 虚拟机栈</h3><blockquote><p>       Java虚拟机规范允许Java栈的大小是动态的或者是固定的。在Java虚拟机规范中，定义了两种异常与栈空间有关：StackOverflowError和OutOfMemoryError;如果线程在计算过程汇总，请求的栈深度大于最大可用的<span>	</span>栈深度，则抛出StackOverflowError;如果Java栈可以动态扩展，而在扩展栈的过程中，没有足够的内存空间来支持栈的扩展，则抛出OutOfMemoryError.在HotSpot虚拟机中，可以使用-Xss参数来设置栈的大小。栈的大小直接决定了函数调用的可达深度。如下案例展示了一个递归调用的应用。计数器count记录了递归的层次，这个没有出口的递归函数一定会导致栈溢出。程序则在栈溢出时，打印出栈的当前深度。</p></blockquote><ul><li><strong>实战2-3</strong>：StackOverflowError 错误分析演示</li></ul><blockquote><p><strong>步骤一</strong>：递归调用打印出一个方法最大调用次数可以反馈出栈的当前深度</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n169" mdtype="fences" style="break-inside: unset;">/**
 * 对JVM 内存模型进行测试
 */
public class TestJVMStack 
    //1.声明一个统计函数调用次数的计数变量
    private int count=0;
    /**
     * 2.声明一个递归函数，该函数调用会产生死循环
     */
    public void recursion(){
        count++;
        recursion();
    }
    /**
     * 3.测试调用该递归函数，打印出统计调用次数
     */
    @Test
    public void testStack(){
        try {
            recursion();
        } catch (Error e) {
            System.out.println("deep of stack is  " +count);
            e.printStackTrace();
        }
    }
}
</pre><p>   控制台打印：</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n171" mdtype="fences">deep of stack is 20630  
java.lang.StackOverflowError
分析：count变量值输出为20630值不是固定的。但是这反映出了函数调用的深度并不大。
</pre><blockquote><p><strong>步骤二</strong>：通过设置-Xss参数来调大栈的内存大小再看栈的深度，对比体会设置栈大小作用</p></blockquote><p><img src='../画图/typora-images/1557404171071.png' alt='1557404171071' referrerPolicy='no-referrer' /></p><p><span>		</span></p><p> 控制台打印出                      </p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n177" mdtype="fences">deep of stack is 216017
java.lang.StackOverflowError
</pre><blockquote><p><strong>总结：</strong><span>	</span></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n180" mdtype="fences">1.-Xss参数设置增加了栈空间大小，程序支持的函数调用深度明显有上升。
</pre><h3><a name='header-n181' class='md-header-anchor '></a>2.4 堆</h3><h4><a name='header-n182' class='md-header-anchor '></a>2.4.1 堆内存分区简介</h4><blockquote><p>JVM的内存模型在1.7和1.8有较大的区别，我们将先学习1.7再学习1.8的内存模型。</p></blockquote><p><img src='../画图/typora-images/1531983836425930ecc6718.jpg' alt='内存结构' referrerPolicy='no-referrer' /></p><p>                                                                             上图 JDK1.7 堆内存图</p><p>                            <img src='..\画图\typora-images\1557407413855.png' alt='1557407413855' referrerPolicy='no-referrer' /> </p><p>                                               上图JDK1.8 废除了JDK1.7中永久区，换成了MetaSpace</p><ul><li><p>Young 年轻区（代）</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n192" mdtype="fences">  新生代又可进一步细分为eden、survivor space0(简称s0或者from space) 、survivor space1(简称s1或者 to space)。eden意义为伊甸园，即对象的出生地，大部分对象刚刚建立时，通常会存放在这里。s0和s1为survivor空间，翻译成中文为幸存者，也就是说存放其中的对象至少经历了一次垃圾回收，并得以幸存。 
</pre></li><li><p>Tenured 年老区(代)</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n195" mdtype="fences">   如果幸存区的对象到了指定年龄仍未被回收，则有机会进入老年代。一般如果系统中用了application级别的缓存，缓存中的对象往往会被转移到这一区间。
</pre></li><li><p>Perm 永久区(代)</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n198" mdtype="fences"> Perm代主要保存class,method,filed对象，这部份的空间一般不会溢出，除非一次性加载了很多的类，不过在涉及到热部署的应用服务器的时候，有时候会遇到java.lang.OutOfMemoryError : PermGen space 的错误，造成这个错误的很大原因就有可能是每次都重新部署，但是重新部署后，类的class没有被卸载掉，这样就造成了大量的class对象保存在了perm中，这种情况下，一般重新启动应用服务器可以解决问题。
</pre><p>&nbsp;</p><blockquote><p><strong>总结:</strong></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n202" mdtype="fences">1.堆空间可以简单分为新生代和老年代。新生代用于存放刚产生的新对象，老年代则存放年长的对象（存在时间较长，经过垃圾回收次数较多的对象）。

2.现实使用中，由于永久代内存经常不够用或发生内存泄露，爆出异java.lang.OutOfMemoryError: PermGen。基于此，JDK1.8将永久区废弃，而改用元空间，改为了使用本地内存空间。Metaspace所占用的内存空间不是在虚拟机内部，而是在本地内存空间中，这也是与1.7的永久代最大的区别所在。
</pre><p>    </p></li></ul><h4><a name='header-n204' class='md-header-anchor '></a>2.4.2 堆内存分配实战</h4><p><strong>案例2-4</strong>：感受JVM堆内部结构</p><blockquote><p><strong>步骤一</strong>：创建实例对象</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n208" mdtype="fences">public class TestHeapGC {
    public static void main(String[] args) {
        byte[] b1=new byte[1024*1024/2];
        byte[] b2=new byte[1024*1024*8];
        b2=null;
        b2=new byte[1024*1024*8]; //进行第1次垃圾回收
        System.gc();
    }
}
</pre><blockquote><p><strong>步骤二</strong>：使用JVM参数参数</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n211" mdtype="fences">-XX:+PrintGCDetails -XX:SurvivorRatio=8 -XX:MaxTenuringThreshold=15 -Xms40M -Xmx40M -Xmn20M
</pre><blockquote><p><strong>步骤三</strong>：分析控制GC详细数据</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n214" mdtype="fences">[GC (System.gc())      [PSYoungGen: 11326K-&gt;1272K(18432K)] 19518K-&gt;9472K(38912K), 0.0020069 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] 
[Full GC (System.gc())  [PSYoungGen: 1272K-&gt;0K(18432K)] [ParOldGen: 8200K-&gt;9375K(20480K)] 9472K-&gt;9375K(38912K), [Metaspace: 3490K-&gt;3490K(1056768K)], 0.0044752 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] 
</pre><blockquote><p><strong>总结</strong>：</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n217" mdtype="fences">通过设置参数可以看到堆内存GC过程；控制台打印出一共有2次GC。
第1次GC:堆大小是38912K，年轻代是18432 通过GC 由11326K减少为1272K。
第2次GC:堆大小是38912K，年轻代是18432K 通过GC由1272K减少为0K；老年代是20480K，由8200K增加到9375K。	     Metaspacke是1056768K，内存没有发生变化。
</pre><p>&nbsp;</p><h4><a name='header-n219' class='md-header-anchor '></a>2.4.3 堆和栈数据存储过程</h4><ul><li>案例：创建student1和student2是如何分配内存的？</li></ul><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n223" mdtype="fences">  public class HeapStackMemory {
      public static void main(String[] args) {
          Student student1 = new Student();
          student1.setName("林青霞");
          Student student2 = new Student();
          student2.setName("张曼玉");
      }
  }
</pre><ul><li>问题分析</li></ul><p><img src='../画图/typora-images/heapstack.gif' alt='heapstack' referrerPolicy='no-referrer' /></p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n228" mdtype="fences">1.main方法入栈， s1引用类型声明，指向了堆中对象s1。
2.setName方法入栈，会执行setName方法，根据地址找到堆中变量赋值。setName方法调用完然后出栈。
3.main方法中s2引用类型声明，指向了堆中对象s2。
4.setName方法入栈，会执行setName方法，根据地址找到堆对中变量赋值。setName方法调用完然后出栈。 
</pre><blockquote><p><strong>总结:</strong></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n231" mdtype="fences">1.方法的调用和执行，都是在栈中完成的，这一过程也称之为“方法入栈和出栈”。方法中局部变量都会随着方法进去
  栈中。引用类型的变量值指明堆中对象的地址。
2.this代表的调用该方法调用对象，谁调用该方法，this就是谁。
</pre><p>&nbsp;</p><h4><a name='header-n233' class='md-header-anchor '></a>2.4.4 堆和栈区别</h4><ul><li><p><strong>问题回答</strong>：分别根据存储数据类型、堆栈数据结构、缓存方式、空间分配4个维度来区别。</p><ul><li><p><u>存储数据类型</u>   掌握</p><p>           <img src='../画图/typora-images/1557387224244.png' alt='1557387224244' referrerPolicy='no-referrer' /></p><ul><li><strong>栈中存储局部变量</strong>：这里所说的栈，也称之为“虚拟机栈”，它里面主要存放一些基本类型的局部变量(int, short, long, byte, float, double, boolean, char)和对象引用。</li><li><strong>堆中存储对象属性</strong>：heap是JVM的内存数据区。每次分配不定长的内存空间，专门用来保存对象的实例。实际上也只是保存对象实例的属性值，属性的类型和对象本身的类型标记等，并不保存对象的方法（方法是指令，保存在Stack中）。对象实例在Heap中分配好以后，需要在Stack中保存一个4字节的Heap内存地址，用来定位该对象实例在Heap中的位置，便于找到该对象实例。</li></ul></li><li><p><u>堆栈数据结构</u>   掌握</p><ul><li><p>栈数据结构：先进后出特点数据结构。如 桶</p><p><img src='../画图/typora-images//1557795436677.png' alt='1557795436677' referrerPolicy='no-referrer' /></p></li><li><p>堆数据结构：先进先出特点数据结构，如 树</p><p><img src='../画图/typora-images//1557874528362.png' alt='1557874528362' referrerPolicy='no-referrer' /></p></li></ul></li><li><p>堆栈缓存方式  了解</p><ul><li>栈使用的是一级缓存， 他们通常都是被调用时处于存储空间中，调用完毕立即释放；</li><li>堆是存放在二级缓存中，生命周期由虚拟机的垃圾回收算法来决定（并不是一旦成为孤儿对象就能被回收）。所以调用这些对象的速度要相对来得低一些。</li></ul></li><li><p>堆栈空间分配   了解</p><ul><li>栈（操作系统）：由操作系统自动分配释放 ，存放函数的参数值，局部变量的值等。其操作方式类似于数据结构中的栈；</li><li>堆（操作系统）： 一般由程序员分配释放， 若程序员不释放，程序结束时可能由OS回收，分配方式倒是类似于链表。</li></ul></li></ul></li></ul><h3><a name='header-n269' class='md-header-anchor '></a>2.5 方法区</h3><p><strong>实战2-5</strong>：让永久区饱和，观察垃圾回收</p><blockquote><p><strong>步骤一：</strong>创建String常量放入常量池</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n273" mdtype="fences">public class TestGenGC {
    public static void main(String[] args) {
        for (int i = 0; i &lt; Integer.MAX_VALUE; i++) {
            String s = String.valueOf(i).intern();// 加入到常量池中
        }
    }
}
</pre><blockquote><p><strong>步骤二</strong>：设置方法永久区大小</p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n276" mdtype="fences">设置参数： -XX:+PrintGCDetails
</pre><p> 控制台打印：</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n278" mdtype="fences">[GC (Allocation Failure) [PSYoungGen: 139776K-&gt;1048K(174592K)] 139776K-&gt;1056K(1013760K), 0.0579842 secs] [Times: user=0.05 sys=0.00, real=0.06 secs] 
[GC (Allocation Failure) [PSYoungGen: 140824K-&gt;1112K(174592K)] 140832K-&gt;1120K(1013760K), 0.1899623 secs] [Times: user=0.20 sys=0.00, real=0.19 secs] 
</pre><blockquote><p><strong>总结：</strong></p></blockquote><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="java" contenteditable="false" cid="n281" mdtype="fences">1.每当常量池饱和时，GC总能顺利回收常量池中的数据，确保程序稳定持续运行。
</pre><p><strong><mark>面试热频问题5</mark></strong>：<u>堆栈内存空间是如何存储数据的？this代表的是什么？</u>      1.堆栈区别+2.堆栈配合使用</p><p><strong><mark>面试热频问题6</mark></strong>：<u>堆和栈区别有哪些?</u>  存储数据类型+数据结构</p><p>&nbsp;</p></div>
</body>
</html>